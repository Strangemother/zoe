(function(a,b){if(typeof exports==="object")module.exports=b();else if(typeof define==="function"&&define.amd)define(function(){return a.$z=b(a.$z)});else a.$z=b(a.$z)})(this,function(a){a=a||function(){return a.main.apply(this,arguments)};a.log=a.dir=function(){};if(typeof console!=="undefined"){if(console.log)a.log=function(a){console.log(a)};if(console.dir)a.dir=function(a){console.dir(a)}}var b=a.fn=function(g,h){if(g instanceof Array){h=g;g=null}var i=function(){return i.run(i._this||this,Array.prototype.splice.call(arguments,0),i.fns)};i.constructor=b;i.fns=h||[];i.run=g||a.fn.LAST_DEFINED;i.on=d;i.off=e;i.first=f;i._this=undefined;i.bind=c;return i};var c=function(a){this._this=a;return this};var d=function(a){this.fns.push(a);return this};var e=function(a){if(!a){this.fns=[];return}for(var b=0;b<this.fns.length;b++)if(this.fns[b]==a){this.fns.splice(b,1);return}};var f=function(a){this.fns=[a].concat(this.fns);return this};a.fn.executeReduce=function(a,b){if(b===undefined){b=a;a=undefined}return function(c,d,e){var f=a;for(var g=0;g<e.length;g++)f=b(f,e[g].apply(c,d));return f}};var g=a.fn.LAST_DEFINED=a.fn.executeReduce(function(a,b){return b!==undefined?b:a});a.fn.STOP_DEFINED=function(b,c,d){var e;for(var f=0;f<d.length;f++){e=d[f].apply(b,c);if(e!==undefined)return e}return e};a.fn.ASYNC=function(b,c,d){var e=0;var f;if(typeof c[c.length-1]=="function")f=c.pop();var g=function(a){return function(){if(d[a])d[a].apply(b,c.concat([g(a+1)]));else if(f)f()}};return g(0)()};a.on=function(b,c,d){var e=b[c];if(!e||e.constructor!=a.fn||e.run!=a.fn.LAST_DEFINED)b[c]=a.fn(e?[e]:[]);b[c].on(d)};a.off=function(b,c,d){if(b[c].constructor==a.fn)return b[c].remove(d)};var h=a.extend=function(c,d,e){var f;if(typeof e=="object"){f=e;e=void 0}for(var g in d)if(!d.hasOwnProperty||d.hasOwnProperty(g)){var h=d[g];var i;var j=g.length;var k=g.substr(0,2)=="__";var l=g.substr(j-2,2)=="__";var m=k&&!l&&(g=g.substr(2))&&a.extend.APPEND||!k&&l&&(g=g.substr(0,j-2))&&a.extend.PREPEND||k&&l&&(g=g.substr(2,j-4))&&a.extend.REPLACE;var n=m||e||f&&(f[g]||f["*"])||a.extend.DEFINE;if(typeof n=="string")n=a.extend[n];try{i=n(c[g],h,f&&a.extend.deriveRules(f,g))}catch(o){a.dir(c);a.dir(d);a.dir(a.extend.deriveRules(e,g));a.log('$z.extend: "'+g+'" override error. \n ->'+(o.message||o))}if(i!==undefined)c[g]=i}return c};a.extend.DEFINE=function(b,c){if(b!==undefined)throw"No override specified.";else return c};var i=a.extend.REPLACE=function(b,c){if(c!==undefined)return c;else return b};a.extend.FILL=function(b,c){if(b===undefined)return c;else return b};var j=a.extend.IGNORE=function(b,c){};a.extend.APPEND=function(c,d,e){if(d.constructor===Object)return a.extend(c||{},d,a.extend.REPLACE);else if(typeof d=="function")return a.extend.CHAIN(c,d);else if(typeof d=="string")return a.extend.STR_APPEND(c,d);else if(d instanceof Array)return a.extend.ARR_APPEND(c,d);else return d};a.extend.PREPEND=function(c,d){if(d.constructor===Object)return a.extend(c||{},d,a.extend.FILL);else if(typeof d=="function")return a.extend.CHAIN_FIRST(c,d);else if(typeof d=="string")return a.extend.STR_PREPEND(c,d);else if(d instanceof Array)return a.extend.ARR_PREPEND(c,d);else return d};a.extend.DREPLACE=function(c,d){if(d.constructor===Object){if(typeof c==="undefined")c={};return a.extend(c,d,a.extend.DREPLACE)}else return d};a.extend.DFILL=function(c,d){if(d.constructor===Object){if(typeof c==="undefined")c={};return h(c,d,a.extend.DFILL)}else return typeof c==="undefined"?d:c};a.extend.ARR_APPEND=function(b,c){return(b||[]).concat(c)};a.extend.ARR_PREPEND=function(b,c){return c.concat(b||[])};a.extend.STR_APPEND=function(b,c){return b?b+c:c};a.extend.STR_PREPEND=function(b,c){return c+b};a.extend.deriveRules=function(a,b){var c={};for(var d in a){if(d=="*.*"){c["*.*"]=a[d];continue}if(d=="*")continue;var e=d.split(".");if(e[0]==b||e[0]=="*")c[e.splice(1).join(".")]=a[d]}return c};a.fn.makeChain=function(b,c,d){return function(e,f){if(!e||e.constructor!=a.fn||!d&&e.run!=b)e=a.fn(b,!e?[]:[e]);if(c)e.first(f);else e.on(f);return e}};a.extend.CHAIN=a.fn.makeChain(a.fn.LAST_DEFINED,false,true);a.extend.CHAIN_FIRST=a.fn.makeChain(a.fn.LAST_DEFINED,true,true);a.extend.CHAIN_STOP_DEFINED=a.fn.makeChain(a.fn.STOP_DEFINED);a.create=function(b,c){c=l(b,c);if(c._definition)throw"Cannot use $z.create on an instance of $z.create";var d;k(c,function(a){if(a._base){d=a._base(c);return true}});d=d||{};d._definition=c;var e={_extend:h.IGNORE,_base:h.IGNORE,_implement:h.IGNORE,_reinherit:h.IGNORE,_make:h.IGNORE,_integrate:h.IGNORE,_built:h.IGNORE};var f=[];var g=a.fn();var i=a.fn();i._this=g._this=d;k(c,function(h){h=i(h,c)||h;if(h._integrate)i.on(h._integrate);a.extend(d,h,e);if(h._extend)a.extend(e,h._extend,a.extend.REPLACE);if(h._make)h._make.call(d,c,h);if(h._built)g.on(h._built);f.push(h)},function(b){return f.indexOf(b)!=-1&&!b._reinherit});g(c);return d};var k=function(b,c,d){d=d||function(){};if(b._implement)for(var e=0,f=b._implement.length;e<f;e++){var g=b._implement[e];if(!g){a.dir(b);a.log("Implementor not defined!")}if(g._definition){g=g._definition}if(d(g))continue;if(k(g,c,d))return true}return c(b)};var l=function(a,b){if(!(a instanceof Array)){b=a;a=[]}b=b||{};b._implement=a.concat(b._implement||[]);return b};a.inherits=function(b,c){if(b._definition)return a.inherits(b._definition,c);if(c._definition)return a.inherits(b,c._definition);var d=false;k(b,function(a){if(a===c){d=true;return true}});return d};a.Constructor={_base:function(a){function b(){return b.construct.apply(this,arguments)}return b},_extend:{prototype:h,construct:h.CHAIN},_integrate:function(b){if(Object.getOwnPropertyDescriptor){console.log(b);var c=Object.getOwnPropertyDescriptor(b,"prototype");if(c&&!c.enumerable)a.extend(this.prototype,b.prototype,a.extend.deriveRules(this._extend,"prototype"))}if(typeof b=="function"&&!b._definition)return{construct:b.construct,prototype:b}},construct:function(){for(var b in this){var c=this[b];if(c&&c.constructor==a.fn)this[b]=a.fn(c.run,[c])}}};return a})