(function(e,t){if(typeof exports==="object")module.exports=t();else if(typeof define==="function"&&define.amd)define(function(){return t()});else e.zoe=t()})(this,function(){var e={};e.log=e.dir=function(){};if(typeof console!=="undefined"){if(console.log)e.log=function(e,t){console.log(e)};if(console.dir)e.dir=function(e,t){console.dir(e)}}var t=e.fn=function(e,o){if(e instanceof Array){o=e;e=null}var u=function(){return u.run(u._this||this,Array.prototype.splice.call(arguments,0),u.fns)};u.constructor=t;u.fns=o||[];u.run=(typeof e=="string"?t[e]:e)||t.LAST_DEFINED;u.on=r;u.off=i;u.first=s;u._this=undefined;u.bind=n;return u};var n=function(e){this._this=e;return this};var r=function(e){this.fns.push(e);return this};var i=function(e){if(!e){this.fns=[];return}for(var t=0;t<this.fns.length;t++)if(this.fns[t]==e){this.fns.splice(t,1);return}};var s=function(e){this.fns=[e].concat(this.fns);return this};t.executeReduce=function(e,t){if(t===undefined){t=e;e=undefined}return function(n,r,i){var s=e;for(var o=0;o<i.length;o++)s=t(s,i[o].apply(n,r));return s}};var o=t.LAST_DEFINED=t.executeReduce(function(e,t){return t!==undefined?t:e});t.STOP_DEFINED=function(t,n,r){var i;for(var s=0;s<r.length;s++){i=r[s].apply(t,n);if(i!==undefined)return i}return i};t.ASYNC=t.ASYNC_NEXT=function(t,n,r){var i=0;var s;if(typeof n[n.length-1]=="function")s=n.pop();var o=function(e){return function(){if(r[e])r[e].apply(t,n.concat([o(e+1)]));else if(s)s()}};return o(0)()};t.ASYNC_SIM=function(t,n,r){var i=0;var s;if(typeof n[n.length-1]=="function")s=n.pop();for(var o=0;o<r.length;o++)r[o].apply(t,n.concat([function(){if(++i==r.length)s()}]))};e.on=function(e,n,r){var i=e[n];if(!i||i.constructor!=t||i.run!=t.LAST_DEFINED)e[n]=t(i?[i]:[]);e[n].on(r)};e.off=function(e,n,r){if(e[n].constructor==t)return e[n].off(r)};var u=e.extend=function(n,r,i){var s=arguments;if(s.length>2)i=s[s.length-1];var o;if(typeof i=="object"){o=i;i=void 0}for(var a in r)if(!r.hasOwnProperty||r.hasOwnProperty(a)){var f=r[a];var l;var c=a.length;var h=a.substr(0,2)=="__";var p=a.substr(c-2,2)=="__";var d=h&&!p&&(a=a.substr(2))&&u.APPEND||!h&&p&&(a=a.substr(0,c-2))&&u.PREPEND||h&&p&&(a=a.substr(2,c-4))&&u.REPLACE;var v=d||i||o&&(o[a]||o["*"])||u.DEFINE;if(typeof v=="string")v=u[v];try{l=v(n[a],f,o&&u.deriveRules(o,a))}catch(m){e.dir(n);e.dir(r);e.dir(u.deriveRules(i,a));e.log('zoe.extend: "'+a+'" override error. \n ->'+(m.message||m))}if(l!==undefined)n[a]=l}if(s.length>3){var g=[n];g.concat(Array.prototype.splice.call(s,2,s.length-3,s.length-3));g.push(i);$z.extend.apply(this,g)}return n};u.EXTEND=u;u.DEFINE=function(t,n){if(t!==undefined)throw"No override specified.";else return n};var a=u.REPLACE=function(t,n){if(n!==undefined)return n;else return t};u.FILL=function(t,n){if(t===undefined)return n;else return t};var f=u.IGNORE=function(t,n){};var l=function(e){return e!=null&&e.constructor==Object};var c=function(e){return typeof e=="function"};var h=function(e){return typeof e=="string"};var p=function(e){return e instanceof Array};u.APPEND=function(t,n,r){if(l(n))return u(t||{},n,u(r||{},{"*":"REPLACE"},"FILL"));else if(c(n))return u.CHAIN(t,n);else if(h(n))return u.STR_APPEND(t,n);else if(p(n))return u.ARR_APPEND(t,n);else return n};u.PREPEND=function(t,n,r){if(l(n))return u(t||{},n,u(r||{},{"*":"FILL"},"FILL"));else if(c(n))return u.CHAIN_FIRST(t,n);else if(h(n))return u.STR_PREPEND(t,n);else if(p(n))return u.ARR_PREPEND(t,n);else return n};u.DAPPEND=function(t,n,r){if(l(n))return u(t||{},n,u(r||{},{"*":"DAPPEND"},"FILL"));else if(c(n))return u.CHAIN(t,n);else if(p(n))return u.ARR_APPEND(t,n);else return n};u.DPREPEND=function(t,n,r){if(l(n))return u(t||{},n,u(r||{},{"*":"DPREPEND"},"FILL"));else if(c(n))return u.CHAIN_FIRST(t,n);else if(p(n))return u.ARR_PREPEND(t,n);else return t!==undefined?t:n};u.DREPLACE=function(t,n,r){if(l(n))return u(t||{},n,u(r||{},{"*":"DREPLACE"},"FILL"));else return n};u.DFILL=function(t,n,r){if(l(n))return u(t||{},n,"DFILL");else return typeof t=="undefined"?n:t};u.ARR_APPEND=function(t,n){return(t||[]).concat(n)};u.ARR_PREPEND=function(t,n){return n.concat(t||[])};u.STR_APPEND=function(t,n){return t?t+n:n};u.STR_PREPEND=function(t,n){return n+t};u.deriveRules=function(e,t){var n={};for(var r in e){if(r=="*.*"){n["*.*"]=e[r];continue}if(r=="*")continue;var i=r.split(".");if(i[0]==t||i[0]=="*")n[i.splice(1).join(".")]=e[r]}return n};u.makeChain=function(e,n,r){return function(i,s){if(!i||i.constructor!=t||!r&&i.run!=e)i=t(e,!i?[]:[i]);if(n)i.first(s);else i.on(s);return i}};u.CHAIN=u.makeChain(t.LAST_DEFINED,false,true);u.CHAIN_FIRST=u.makeChain(t.LAST_DEFINED,true,true);u.CHAIN_STOP_DEFINED=u.makeChain(t.STOP_DEFINED);e.create=function(e,n){n=v(e,n);if(n._definition)throw"Cannot use zoe.create on an instance of zoe.create";var r;d(n,function(e){if(e._base){r=e._base(n);return true}});r=r||{};r._definition=n;var i={_extend:u.IGNORE,_base:u.IGNORE,_implement:u.IGNORE,_reinherit:u.IGNORE,_make:u.IGNORE,_integrate:u.IGNORE,_built:u.IGNORE};var s=[];var o=t();var a=t();a._this=o._this=r;d(n,function(t){t=a(t,n)||t;if(t._integrate)a.on(t._integrate);if(t._extend)u(i,t._extend,"REPLACE");u(r,t,i);if(t._make)t._make.call(r,n,t);if(t._built)o.on(t._built);s.push(t)},function(t){return s.indexOf(t)!=-1&&!t._reinherit});o(n);return r};var d=function(t,n,r){r=r||function(){};if(t._implement)for(var i=0,s=t._implement.length;i<s;i++){var o=t._implement[i];if(!o){e.dir(t);e.log("Implementor not defined!")}if(o._definition){o=o._definition}if(r(o))continue;if(d(o,n,r))return true}return n(t)};var v=function(e,t){if(!(e instanceof Array)){t=e;e=[]}t=t||{};t._implement=e.concat(t._implement||[]);return t};e.inherits=function(t,n){if(t._definition)return e.inherits(t._definition,n);if(n._definition)return e.inherits(t,n._definition);var r=false;d(t,function(e){if(e===n){r=true;return true}});return r};e.Constructor={_base:function(e){function t(){t.construct.apply(this,arguments)}return t},_extend:{prototype:u,construct:u.CHAIN},_integrate:function(e){var t=Object.getOwnPropertyDescriptor;if(t){var n=t(e,"prototype");if(n&&!n.enumerable)u(this.prototype,e.prototype,u.deriveRules(this._extend,"prototype"))}if(typeof e=="function"&&!e._definition)return{construct:e.construct,prototype:e}},construct:function(){for(var e in this){var n=this[e];if(n&&n.constructor==t){this[e]=t(n.run,[n]);this[e].bind(this)}}}};return e})